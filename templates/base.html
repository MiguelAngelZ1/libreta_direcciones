<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Mi Aplicación{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
  {% block nav %}{% endblock %}
  
  
  <div class="container">
    {% block content %}{% endblock %}
  </div>

  from flask import Flask, render_template, request, redirect, url_for, flash
import os
import psycopg2
from psycopg2.extras import RealDictCursor

app = Flask(__name__)
app.secret_key = "EMIteamo.2025"  # Recuerda usar variables de entorno en producción

# URL de conexión: utiliza la variable de entorno o el valor por defecto
DATABASE_URL = os.getenv(
    "DATABASE_URL",
    "postgresql://libreta_db_user:A2OwJBOrJacD7MX38Y2XNisNprYVk066@dpg-d0548gvgi27c73cac2q0-a.oregon-postgres.render.com/libreta_db"
)

def db_connection():
    """Establece la conexión a PostgreSQL."""
    try:
        return psycopg2.connect(
            DATABASE_URL,
            sslmode="require",
            connect_timeout=10
        )
    except psycopg2.Error as e:
        print(f"Error de conexión a la base de datos: {e}")
        return None

@app.route("/")
def index():
    return render_template("index.html")

@app.route("/add", methods=["GET", "POST"])
def add():
    if request.method == "POST":
        grado = request.form.get("grado", "").strip()
        nombre = request.form.get("nombre", "").strip()
        apellido = request.form.get("apellido", "").strip()
        dni = request.form.get("dni", "").strip()

        # Validaciones básicas
        if not nombre or not apellido or not dni:
            flash("❌ Todos los campos son requeridos.", "danger")
        elif not dni.isdigit() or len(dni) != 8:
            flash("❌ El DNI debe contener solo números y tener 8 dígitos.", "danger")
        else:
            conn = db_connection()
            if conn is None:
                flash("❌ Error de conexión a la base de datos.", "danger")
            else:
                try:
                    with conn:
                        with conn.cursor() as cursor:
                            # Verificar si ya existe un contacto con ese DNI
                            query = "SELECT id FROM contactos WHERE dni = %s"
                            cursor.execute(query, (dni,))
                            if cursor.fetchone():
                                flash("❌ Ya existe un contacto con el mismo DNI.", "danger")
                            else:
                                sql = """
                                    INSERT INTO contactos (grado, nombre, apellido, dni)
                                    VALUES (%s, %s, %s, %s)
                                """
                                cursor.execute(sql, (grado, nombre.capitalize(), apellido.upper(), dni))
                                flash("✅ Contacto agregado correctamente.", "success")
                    # Redirigimos para limpiar el formulario y evitar reenvíos al refrescar
                    return redirect(url_for("add"))
                except Exception as e:
                    print(f"Error al insertar contacto: {e}")
                    flash("❌ Error al agregar el contacto.", "danger")
    return render_template("add.html")

if __name__ == "__main__":
    app.run(debug=True, host="0.0.0.0", port=5000)


  <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
