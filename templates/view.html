{% extends "base.html" %}

{% block title %}Ver Registros - Mi Aplicaci√≥n{% endblock %}

{% block content %}
  <div class="container mt-4">
    <h2>Registros en la Libreta</h2>

    <!-- Campo de b√∫squeda y botones -->
    <div class="d-flex gap-2 mb-3">
      <input type="text" id="searchBox" class="form-control w-50" placeholder="Buscar por nombre, apellido o DNI">
      <button class="btn btn-warning" onclick="limpiarBusqueda()">üßπ Limpiar B√∫squeda</button>
      <button class="btn btn-dark mt-3" onclick="window.location.href='{{ url_for('index') }}'">üè† Volver al inicio</button>

    </div>

    {% if registros %}
      <table id="contactTable" class="table table-striped table-hover">
        <thead class="table-dark">
          <tr>
            <th>Grado</th>
            <th>Nombre</th>
            <th>Apellido</th>
            <th>DNI</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          {% for registro in registros %}
            <tr data-nombre="{{ registro.nombre | lower }}"
                data-apellido="{{ registro.apellido | lower }}"
                data-dni="{{ registro.dni }}">
              <td>{{ registro.grado }}</td>
              <td>{{ registro.nombre }}</td>
              <td>{{ registro.apellido }}</td>
              <td>{{ registro.dni }}</td>
              <td>
                <button class="btn btn-primary btn-sm btn-editar"
                        data-id="{{ registro.id }}"
                        data-grado="{{ registro.grado }}"
                        data-nombre="{{ registro.nombre }}"
                        data-apellido="{{ registro.apellido }}"
                        data-dni="{{ registro.dni }}">
                  ‚úèÔ∏è Editar
                </button>
                <button class="btn btn-danger btn-sm btn-eliminar" data-id="{{ registro.id }}">
                  ‚ùå Eliminar
                </button>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p class="alert alert-info">No hay registros disponibles.</p>
    {% endif %}
  </div>

  <!-- Modal para edici√≥n -->
  <div id="editModal" class="modal" style="display: none;">
    <div class="modal-content bg-light p-4 border rounded">
        <h2>Editar Contacto</h2>
        <form id="editForm" method="POST" action="/edit">
            <input type="hidden" id="editId" name="id">
            <div class="mb-3">
                <label>Grado:</label>
                <input type="text" id="editGrado" name="grado" class="form-control">
            </div>
            <div class="mb-3">
                <label>Nombre:</label>
                <input type="text" id="editNombre" name="nombre" class="form-control">
            </div>
            <div class="mb-3">
                <label>Apellido:</label>
                <input type="text" id="editApellido" name="apellido" class="form-control" pattern="[A-Za-z\s]+" title="El apellido solo debe contener letras">
            </div>
            <div class="mb-3">
                <label>DNI:</label>
                <input type="text" id="editDni" name="dni" class="form-control">
            </div>
            <div class="modal-buttons text-end">
                <button type="button" class="btn btn-secondary" onclick="cerrarModal()">Cancelar</button>
                <button type="submit" class="btn btn-success">Confirmar cambios</button>
            </div>
        </form>
    </div>
  </div>
{% endblock %}
